# TLRS Calculator - Excel Calendar Sheet Improvements (v2.2)

## Overview
The Excel Calendar sheet has been redesigned for a cleaner, more professional, and audit-friendly layout. Focus is on reducing visual noise while maintaining clarity and scanability.

## Key Improvements

### 1. Reduced Visual Noise in Day Cells
**Before:** Each cell showed verbose labels like "Working Day", "Weekend", "Public Holiday"
**After:** Compact status markers with minimal text

- **WD** (Working Day): Small grey text, eligible for reimbursement
- **WE** (Weekend): Shown in light blue shaded columns
- **PH** (Public Holiday): Marker + holiday name in red italic text
- **PL** (Personal Leave): Marker + "Personal Leave" in pale yellow cells

### 2. Legend Box
Added a clear legend (top-right, under title) explaining all status markers:
```
Legend:
WD = Working Day (Eligible)
WE = Weekend (Excluded)
PH = Public Holiday (Excluded)
PL = Personal Leave (Excluded)
```

### 3. Improved Visual Language
- **Weekend columns** (Sunday + Saturday): Light blue background for all cells
- **Public holiday cells**: Red italic holiday name text (no background tint)
- **Personal leave cells**: Pale yellow background with "PL" marker
- **Working day cells**: White background with small grey "WD" marker
- **Out-of-month cells**: Light grey background for clarity

### 4. Enhanced Summary Block
Clearer, self-explanatory summary section:

```
SUMMARY
Eligible Working Days: 20

Exclusions:
  • Weekends excluded: 8
  • Public holidays excluded: 2
  • Personal leave excluded: 0

Selected Grade: JG5
Rate: RM50/day

Total Reimbursement (Selected): RM 1,000.00

Reference - All Grades:
  JGA: RM 5,000.00
  JG8/JGB: RM 4,000.00
  JG7: RM 3,000.00
  JG6: RM 2,000.00
  JG5: RM 1,000.00 (highlighted)

Holiday source: sabah.gov.my (retrieved: 2026-01-21 16:44)
```

### 5. Professional Print Setup
- **Page**: A4 Landscape
- **Margins**: 0.4" all sides (compact but readable)
- **Gridlines**: Disabled for clean appearance
- **Print area**: Optimized to fit 1 page wide × 1 page tall
- **Footer**: "Generated by TLRS Calculator • YYYY-MM-DD HH:MM"

### 6. Offline Mode Indicator
- If offline mode is enabled, a clear note appears in the summary:
  - "Offline mode: public holidays NOT excluded"
  - Text in orange italic for visibility

### 7. Details Sheet Enhancements
- Offline mode warning banner at top (if applicable)
- Same professional formatting as Calendar sheet
- Useful for audit trail and verification

## Cell Content Structure

Each in-month date cell now follows this structure:

```
Line 1: Day number (bold, 16pt)
Line 2: Status marker (WD/WE/PH/PL, 8pt grey)
Line 3: Holiday name or "Personal Leave" (8pt, red for holidays)
```

Example cells:
```
1
WD

---

15
PH
Hari Raya Puasa

---

8
WE

---

12
PL
Personal Leave
```

## Color Scheme

| Element | Color | Purpose |
|---------|-------|---------|
| Title background | Dark blue (#366092) | Professional header |
| Header row | Dark blue (#366092) | Column labels |
| Weekend columns | Light blue (#E7F0F7) | Visual grouping |
| Out-of-month cells | Light grey (#F0F0F0) | Clarity |
| Personal leave cells | Pale yellow (#FFFACD) | Distinction |
| Holiday names | Red (#C00000) | Emphasis |
| Selected grade row | Light red (#FFE6E6) | Highlight |
| Summary header | Light blue (#D9E1F2) | Section break |

## Borders & Spacing

- **Grid borders**: Thin light grey (#CCCCCC) for subtle appearance
- **Summary borders**: Thin black for definition
- **Row heights**: Fixed 70px for calendar cells (consistent)
- **Column widths**: 24 units for all day columns (consistent)
- **No gridlines**: Disabled for professional print appearance

## Fonts

- **Title**: Calibri 28pt bold white
- **Headers**: Calibri 11pt bold white
- **Day numbers**: Calibri 16pt bold
- **Status markers**: Calibri 8pt bold grey
- **Holiday names**: Calibri 8pt red italic
- **Summary labels**: Calibri 10pt
- **Summary values**: Calibri 10pt bold
- **Footer**: Calibri 8pt italic grey

## Acceptance Criteria Met

✅ Working days no longer show "Working Day" text in every cell  
✅ Public holiday cells display `PH` plus holiday name in red  
✅ Weekend columns remain shaded and show `WE`  
✅ Personal leave visible as `PL` in pale yellow  
✅ Summary block clearly states eligible days, exclusions, grade/rate, and total  
✅ Output prints cleanly to A4 landscape with correct print area  
✅ Legend explains all status markers  
✅ Offline mode clearly indicated  
✅ Professional, audit-friendly appearance  

## Technical Implementation

- Built with `openpyxl` library
- Uses `calendar.monthcalendar()` for Sunday-first layout
- Reusable style constants for consistency
- Multi-line cell content with `"\n"` and `wrap_text=True`
- Explicit row heights and column widths (no auto-sizing)
- Gridlines disabled via `sheet_view.showGridLines = False`
- Print area optimized for 1-page output

## Files Modified

- `excel_export.py`: Complete redesign of `_create_calendar_sheet()` method
- `tlrs_gui_v2.py`: Updated `export_excel()` to pass `offline_mode` and `holiday_source`
- `README.md`: Updated documentation with new features

## Testing Recommendations

1. Export a month with multiple holidays (e.g., May 2026)
2. Export a month with no holidays
3. Test with offline mode enabled
4. Test with personal leave dates
5. Print to PDF and verify 1-page fit
6. Verify holiday names display correctly in red
7. Check that weekend columns are consistently shaded
8. Verify summary calculations match GUI display
